<div align="center">

# âœ¨ PostgreSQL Minimum Database Container âœ¨

![PostgreSQL](https://img.shields.io/badge/PostgreSQL-v16-blue)
![Podman](https://img.shields.io/badge/Podman-CLI-9cf)

</div>

## ğŸ“‹ æ¦‚è¦

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã€Podman CLIã‚’ä½¿ç”¨ã—ã¦PostgreSQLãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ã¿ã‚’å®Ÿè¡Œã™ã‚‹ã‚³ãƒ³ãƒ†ãƒŠç’°å¢ƒã‚’æä¾›ã—ã¾ã™ã€‚mcp_uxã‚¹ã‚­ãƒ¼ãƒã§ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒåˆæœŸåŒ–ã•ã‚Œã€ã™ãã«ä½¿ç”¨ã§ãã‚‹çŠ¶æ…‹ã«ãªã‚Šã¾ã™ã€‚

## ğŸ› ï¸ æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: PostgreSQL 16
- **ã‚³ãƒ³ãƒ†ãƒŠç®¡ç†**: Podman CLI

## ğŸ“¥ ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•

### å‰ææ¡ä»¶

- Windows PC
- [Podman CLI](https://podman.io/getting-started/installation#windows) ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã“ã¨
- WSL2 ãŒæœ‰åŠ¹åŒ–ã•ã‚Œã¦ã„ã‚‹ã“ã¨ï¼ˆPodman for Windows ã®è¦ä»¶ï¼‰

### ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †

1. ãƒªãƒã‚¸ãƒˆãƒªã‚’ã‚¯ãƒ­ãƒ¼ãƒ³ã¾ãŸã¯ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰:

```bash
git clone https://github.com/Masa1984a/PostgreSQL_Minimum_Database_Container.git
cd PostgreSQL_Minimum_Database_Container
```

2. ä½¿ç”¨ä¸­ã®Podmanãƒã‚·ãƒ³ã‚’ç¢ºèª:

```bash
podman machine list
```

ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªãƒã‚·ãƒ³ï¼ˆåå‰ã®æ¨ªã«`*`ãŒã¤ã„ã¦ã„ã‚‹ã‚‚ã®ï¼‰ãŒã™ã§ã«èµ·å‹•ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚
ã‚‚ã—ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªãƒã‚·ãƒ³ãŒãªã„å ´åˆã‚„èµ·å‹•ã—ã¦ã„ãªã„å ´åˆã¯ã€åˆæœŸåŒ–ã¨èµ·å‹•ã‚’è¡Œã„ã¾ã™:

```bash
podman machine init
podman machine start
podman machine start <ãƒã‚·ãƒ³å>
```

3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç”¨ã®æ°¸ç¶šãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚’ä½œæˆ:

```bash
podman volume create postgres_data
```

4. Podman CLI ã§ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•:

```bash
podman run -d --name postgres-db \
  -e POSTGRES_USER=postgres \
  -e POSTGRES_PASSWORD=postgres \
  -e POSTGRES_DB=mcp_ux \
  -v postgres_data:/var/lib/postgresql/data \
  -v ./db/init:/docker-entrypoint-initdb.d \
  -p 5432:5432 \
  postgres:16
```

Windows PowerShellã§ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«å®Ÿè¡Œã—ã¾ã™:

```powershell
podman run -d --name postgres-db `
  -e POSTGRES_USER=postgres `
  -e POSTGRES_PASSWORD=postgres `
  -e POSTGRES_DB=mcp_ux `
  -v postgres_data:/var/lib/postgresql/data `
  -v ./db/init:/docker-entrypoint-initdb.d `
  -p 5432:5432 `
  postgres:16
```

5. ã‚³ãƒ³ãƒ†ãƒŠãŒæ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª:

```bash
podman ps
```

6. Podmanãƒã‚·ãƒ³ã®æ¥ç¶šç”¨IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ç¢ºèª:

```bash
podman machine ssh "ip addr show eth0 | grep 'inet '"
podman machine ssh "ip addr show <ãƒã‚·ãƒ³å> eth0 | grep 'inet '"
```

ã“ã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆä¾‹ï¼š172.xx.xx.xxï¼‰ã‚’ä½¿ç”¨ã—ã¦PostgreSQLã«æ¥ç¶šã—ã¾ã™ã€‚

## ğŸ“Š ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šæƒ…å ±

- **ãƒ›ã‚¹ãƒˆ**: Podmanãƒã‚·ãƒ³ã® IP ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆ`podman machine ssh "ip addr show eth0 | grep 'inet '"` ã§ç¢ºèªï¼‰
- **ãƒãƒ¼ãƒˆ**: 5432
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å**: mcp_ux
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼å**: postgres
- **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰**: postgres
- **ã‚¹ã‚­ãƒ¼ãƒå**: mcp_ux

> **æ³¨æ„**: Windows ã‹ã‚‰æ¥ç¶šã™ã‚‹å ´åˆã€`localhost` ã§ã¯ãªãå¿…ãš Podman ãƒã‚·ãƒ³ã® IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚

## ğŸ“– ä½¿ç”¨æ–¹æ³•

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¸ã®æ¥ç¶š

ä»»æ„ã®PostgreSQLã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ä½¿ç”¨ã—ã¦æ¥ç¶šã§ãã¾ã™:

#### psql (ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³):

```bash
podman exec -it postgres-db psql -U postgres -d mcp_ux
```

#### pgAdmin ã‚„ DBeaver ãªã©ã®GUIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ:

ä¸Šè¨˜ã®æ¥ç¶šæƒ…å ±ã‚’ä½¿ç”¨ã—ã¦æ¥ç¶šã—ã¦ãã ã•ã„ã€‚

### ã‚³ãƒ³ãƒ†ãƒŠã®ç®¡ç†

#### ã‚³ãƒ³ãƒ†ãƒŠã®åœæ­¢:

```bash
podman stop postgres-db
```

#### ã‚³ãƒ³ãƒ†ãƒŠã®å†èµ·å‹•:

```bash
podman start postgres-db
```

#### ãƒ­ã‚°ã®ç¢ºèª:

```bash
podman logs -f postgres-db
```

#### æ¥ç¶šã®å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆ:

```bash
# Podmanãƒã‚·ãƒ³ãŒå®Ÿè¡Œä¸­ã‹ç¢ºèª
podman machine list

# ã‚³ãƒ³ãƒ†ãƒŠã®çŠ¶æ…‹ã‚’ç¢ºèª
podman ps -a

# ã‚³ãƒ³ãƒ†ãƒŠã‚’å†èµ·å‹•
podman restart postgres-db

# Podmanãƒã‚·ãƒ³ã®æ¥ç¶šç”¨IPã‚’ç¢ºèª
podman machine ssh "ip addr show eth0 | grep 'inet '"
```

ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ã§ãƒãƒ¼ãƒˆ5432ãŒé–‹æ”¾ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚‚ç¢ºèªã—ã¦ãã ã•ã„ã€‚

## ğŸ“ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

```
project/
â”œâ”€â”€ db/                  # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«
â”‚   â””â”€â”€ init/            # åˆæœŸåŒ–SQLã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”‚       â””â”€â”€ init.sql     # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆæœŸåŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”œâ”€â”€ docker-compose.yml   # ã‚³ãƒ³ãƒ†ãƒŠæ§‹æˆãƒ•ã‚¡ã‚¤ãƒ«
â””â”€â”€ README.md            # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆèª¬æ˜
```

> **æ³¨æ„**: ãƒ‡ãƒ¼ã‚¿ã¯`postgres_data`ã¨ã„ã†åå‰ä»˜ããƒœãƒªãƒ¥ãƒ¼ãƒ ã«ä¿å­˜ã•ã‚Œã‚‹ãŸã‚ã€`db/data`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¯ä¸è¦ã§ã™ã€‚

## ğŸ“‹ åˆæœŸãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ§‹é€ 

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€ã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•æ™‚ã«ä»¥ä¸‹ã®ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹é€ ã¨ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ãŒ `mcp_ux` ã‚¹ã‚­ãƒ¼ãƒã«è‡ªå‹•çš„ã«ä½œæˆã•ã‚Œã¾ã™ã€‚

### ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹é€ 

| ãƒ†ãƒ¼ãƒ–ãƒ«å | èª¬æ˜ |
|------------|------|
| users | ã‚·ã‚¹ãƒ†ãƒ ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’ç®¡ç† |
| accounts | ã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼ˆä¼æ¥­ï¼‰æƒ…å ±ã‚’ç®¡ç† |
| categories | ãƒã‚±ãƒƒãƒˆã®ã‚«ãƒ†ã‚´ãƒªã‚’ç®¡ç† |
| category_details | ã‚«ãƒ†ã‚´ãƒªã®è©³ç´°æƒ…å ±ã‚’ç®¡ç† |
| statuses | ãƒã‚±ãƒƒãƒˆã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ç®¡ç† |
| request_channels | å•ã„åˆã‚ã›ã®å—ä»˜ãƒãƒ£ãƒãƒ«ã‚’ç®¡ç† |
| response_categories | å¯¾å¿œåˆ†é¡ã‚’ç®¡ç† |
| tickets | ãƒ¡ã‚¤ãƒ³ã¨ãªã‚‹ãƒã‚±ãƒƒãƒˆæƒ…å ±ã‚’ç®¡ç† |
| attachments | ãƒã‚±ãƒƒãƒˆã«æ·»ä»˜ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±ã‚’ç®¡ç† |
| ticket_history | ãƒã‚±ãƒƒãƒˆã®å¤‰æ›´å±¥æ­´ã‚’ç®¡ç† |
| history_changed_fields | å¤‰æ›´ã•ã‚ŒãŸãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®è©³ç´°ã‚’ç®¡ç† |

### ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿

åˆæœŸåŒ–æ™‚ã«ä»¥ä¸‹ã®ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ãŒç™»éŒ²ã•ã‚Œã¾ã™ï¼š

- **ãƒ¦ãƒ¼ã‚¶ãƒ¼**: æ‹…å½“è€…2åï¼ˆå±±ç”°å¤ªéƒã€éˆ´æœ¨èŠ±å­ï¼‰ã€ãƒªã‚¯ã‚¨ã‚¹ã‚¿2åï¼ˆä½è—¤æ¬¡éƒã€é«˜æ©‹ä¸‰éƒï¼‰
- **ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ**: 3ç¤¾ï¼ˆæ ªå¼ä¼šç¤¾ABCã€XYZæ ªå¼ä¼šç¤¾ã€123æ ªå¼ä¼šç¤¾ï¼‰
- **ã‚«ãƒ†ã‚´ãƒª**: å•åˆã›ã€ãƒ‡ãƒ¼ã‚¿ä¿®æ­£ä¾é ¼ã€éšœå®³å ±å‘Š
- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: å—ä»˜æ¸ˆã€å¯¾å¿œä¸­ã€ç¢ºèªä¸­ã€å®Œäº†
- **å—ä»˜ãƒãƒ£ãƒãƒ«**: Emailã€é›»è©±ã€Teams
- **ãƒã‚±ãƒƒãƒˆ**: ã‚µãƒ³ãƒ—ãƒ«ãƒã‚±ãƒƒãƒˆ3ä»¶ï¼ˆæ¤œç´¢æ©Ÿèƒ½ã®å•é¡Œã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒã‚¹ã‚¿ãƒ¼æ›´æ–°ä¾é ¼ã€ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰è¡¨ç¤ºä¸å…·åˆï¼‰

å„ãƒ†ãƒ¼ãƒ–ãƒ«ã«ã¯é©åˆ‡ãªé–¢é€£ä»˜ã‘ãŒã•ã‚Œã¦ãŠã‚Šã€ãƒã‚±ãƒƒãƒˆå‡¦ç†ã‚·ã‚¹ãƒ†ãƒ ã®ãƒ¢ãƒ‡ãƒ«ã¨ã—ã¦æ©Ÿèƒ½ã—ã¾ã™ã€‚

## ğŸ§ª é–‹ç™ºã®ãƒ’ãƒ³ãƒˆ

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®æ°¸ç¶šåŒ–ã«ã¤ã„ã¦

ã“ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã§ã¯ã€åå‰ä»˜ããƒœãƒªãƒ¥ãƒ¼ãƒ  `postgres_data` ã‚’ä½¿ç”¨ã—ã¦ãƒ‡ãƒ¼ã‚¿ã‚’æ°¸ç¶šåŒ–ã—ã¦ã„ã¾ã™ã€‚ã“ã®æ–¹æ³•ã«ã¯ä»¥ä¸‹ã®åˆ©ç‚¹ãŒã‚ã‚Šã¾ã™ï¼š

- ã‚³ãƒ³ãƒ†ãƒŠã‚’å‰Šé™¤ã—ã¦ã‚‚ã€ãƒ‡ãƒ¼ã‚¿ã¯ä¿æŒã•ã‚Œã¾ã™
- PodmanãŒãƒœãƒªãƒ¥ãƒ¼ãƒ ã®ç®¡ç†ã¨ãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³å•é¡Œã‚’è§£æ±ºã—ã¾ã™
- ãƒ›ã‚¹ãƒˆãƒã‚·ãƒ³ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã¨ã®äº’æ›æ€§ã®å•é¡Œã‚’å›é¿ã§ãã¾ã™

#### é‡è¦: æ°¸ç¶šæ€§ã®ç¯„å›²ã«ã¤ã„ã¦

åå‰ä»˜ããƒœãƒªãƒ¥ãƒ¼ãƒ ã¯ **Podmanãƒã‚·ãƒ³ï¼ˆWSL2ä»®æƒ³ç’°å¢ƒï¼‰å†…ã«ä½œæˆ** ã•ã‚Œã¾ã™ï¼š

- ã‚³ãƒ³ãƒ†ãƒŠã‚’å‰Šé™¤ãƒ»å†ä½œæˆã—ã¦ã‚‚ãƒ‡ãƒ¼ã‚¿ã¯ä¿æŒã•ã‚Œã¾ã™
- Podmanãƒã‚·ãƒ³ã‚’å†èµ·å‹•ã—ã¦ã‚‚ãƒ‡ãƒ¼ã‚¿ã¯ä¿æŒã•ã‚Œã¾ã™
- **ãŸã ã—ã€Podmanãƒã‚·ãƒ³è‡ªä½“ã‚’å‰Šé™¤ã™ã‚‹ã¨ã€ãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚‚ä¸€ç·’ã«æ¶ˆãˆã¾ã™**

é‡è¦ãªãƒ‡ãƒ¼ã‚¿ã¯å®šæœŸçš„ã«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã™ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ï¼š

```bash
# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’å–å¾—ï¼ˆWindowsã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã«ä¿å­˜ï¼‰
podman exec -it postgres-db pg_dump -U postgres mcp_ux > backup.sql

# å¿…è¦ã«å¿œã˜ã¦å¾©å…ƒã™ã‚‹å ´åˆ
podman exec -it postgres-db psql -U postgres -d mcp_ux < backup.sql
```

ãƒœãƒªãƒ¥ãƒ¼ãƒ ã®å ´æ‰€ã‚’ç¢ºèªã™ã‚‹ã«ã¯:

```bash
podman volume inspect postgres_data
```

é€šå¸¸ã€ã“ã®ãƒ‘ã‚¹ã¯Podmanãƒã‚·ãƒ³å†…ã® `/var/lib/containers/storage/volumes/postgres_data/_data` ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒã®å¤‰æ›´

`./db/init/init.sql` ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã‚³ãƒ³ãƒ†ãƒŠã®åˆå›èµ·å‹•æ™‚ã«ã®ã¿å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚æ—¢å­˜ã®ã‚³ãƒ³ãƒ†ãƒŠã§ã‚¹ã‚­ãƒ¼ãƒã‚’å¤‰æ›´ã™ã‚‹å ´åˆã¯ã€ä»¥ä¸‹ã®æ‰‹é †ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„:

1. ã‚³ãƒ³ãƒ†ãƒŠã‚’åœæ­¢:

```bash
podman stop postgres-db
podman rm postgres-db
```

2. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚’å‰Šé™¤ï¼ˆæ³¨æ„: å…¨ãƒ‡ãƒ¼ã‚¿ãŒæ¶ˆå»ã•ã‚Œã¾ã™ï¼‰:

```bash
podman volume rm postgres_data
podman volume create postgres_data
```

3. init.sql ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†

4. ã‚³ãƒ³ãƒ†ãƒŠã‚’å†ä½œæˆ:

```bash
podman run -d --name postgres-db \
  -e POSTGRES_USER=postgres \
  -e POSTGRES_PASSWORD=postgres \
  -e POSTGRES_DB=mcp_ux \
  -v postgres_data:/var/lib/postgresql/data \
  -v ./db/init:/docker-entrypoint-initdb.d \
  -p 5432:5432 \
  postgres:16
```

### Podman ãƒã‚·ãƒ³ã®ç®¡ç†

Podman ãƒã‚·ãƒ³ã‚’åœæ­¢ã™ã‚‹å ´åˆ:

```bash
podman machine stop
```

Podman ãƒã‚·ãƒ³ã‚’å†é–‹ã™ã‚‹å ´åˆ:

```bash
podman machine start
```

## ğŸ“ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

[MIT](LICENSE)